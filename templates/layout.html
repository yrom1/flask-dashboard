<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8" />
    <meta content="width=device-width, initial-scale=1" name="viewport" />
    <link href="/static/ginkgo.png" rel="icon" type="image/png" />
    <title>
        {{ title }}
    </title>
    <link href="/static/styles.css" rel="stylesheet" />

    <!-- START PREVIEW -->
    <!-- Open Graph -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://yrom1.ca/">
    <meta property="og:title" content="Ryan's website.">
    <meta property="og:description" content="Personal dashboard">
    <meta property="og:image" itemprop="image"
        content="https://raw.githubusercontent.com/yrom1/opengraph-preview/main/opengraph.png">

    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://yrom1.ca/">
    <meta property="twitter:title" content="Ryan's website.">
    <meta property="twitter:description" content="Personal dashboard">
    <meta property="twitter:image"
        content="https://raw.githubusercontent.com/yrom1/opengraph-preview/main/opengraph.png">
    <!-- END PREVIEW -->
    {{ head }}
    <script src='https://cdn.plot.ly/plotly-2.14.0.min.js'></script>
</head>

<body>
    <header class="head">
        <img alt="credit: Jean-Pol GRANDMONT" class="ginkgo" src="/static/trees.jpg" />
        <h1>Ryan Moore</h1>
        <h2>
            <a href="{{ url_for('about') }}">about me</a>
            |
            <a href="{{ url_for('dashboard') }}">dashboard</a>
            |
            <a href="{{ url_for('mypandas') }}">mypandas</a>
            |
            <a href="{{ url_for('ty') }}">ty</a>
            |
            <a href="{{ url_for('exlog') }}">exlog</a>
            |
            <a href="{{ url_for('postgrespy') }}">postgrespy</a>
            |
            <a href="{{ url_for('fun') }}">fun</a>
        </h2>
        <hr />
    </header>

    {{ content }}

    <script>
        let HEIGHT = 300;
        // TODO DRY

        // jira plot
        (async function () {
            var trace1 = {
                type: 'bar',
                marker: {
                    color: 'blue',
                    line: {
                        width: 2.5
                    }
                }
            };

            const url = "https://raw.githubusercontent.com/yrom1/strava-rest/main/plot.json"
            const jira_r = fetch(url)
                .then((response) => response.json())
                .then((x) => {
                    return x;
                });
            let jira_json = await jira_r;
            trace1.x = Object.values(jira_json.date);
            trace1.y = Object.values(jira_json.value);

            const days_since_last_run = trace1.y.slice().reverse().findIndex((x) => x > 0);

            var layout = {
                title: days_since_last_run.toString() + " Days Since Last Run",
                font: { size: 14 },
                // xaxis: { title: { text: "Date" } },
                yaxis: { title: { text: "Distance Ran (km)" } },
                height: HEIGHT,
            };

            var config = { responsive: true }
            var data = [trace1];
            Plotly.newPlot('strava', data, layout, config);
            window.dispatchEvent(new Event('resize'));

        })();

        // leetcode plot
        (async function () {
            const url = "https://raw.githubusercontent.com/yrom1/yrom1/main/plot.json"
            const jira_r = fetch(url)
                .then((response) => response.json())
                .then((x) => {
                    return x;
                });
            let jira_json = await jira_r;

            var trace1 = {
                type: 'scatter',
                name: 'Python',
                marker: {
                    color: 'blue',
                    line: {
                        width: 2.5
                    }
                }
            };
            trace1.x = Object.values(jira_json.py_dates);
            trace1.y = Object.values(jira_json.py_ranks);

            var trace2 = {
                type: 'scatter',
                name: 'SQL',
                marker: {
                    color: 'orange',
                    line: {
                        width: 2.5
                    }
                }
            };
            trace2.x = Object.values(jira_json.sql_dates);
            trace2.y = Object.values(jira_json.sql_ranks);

            let py_rank = trace1.y.slice();
            let sql_rank = trace2.y.slice();

            let py_start = py_rank.slice(-7)[0]
            let sql_start = sql_rank.slice(-7)[0]

            let num_questions = (py_rank.slice(-1)[0] - py_start) + (sql_rank.slice(-1)[0] - sql_start)

            var layout = {
                title: num_questions.toString() + " LeetCode Questions this Week",
                font: { size: 14 },
                // xaxis: { title: { text: "Date" } },
                yaxis: { title: { text: "# Completed Questions" } },
                height: HEIGHT,
            };

            var config = { responsive: true }
            var data = [trace1, trace2];
            Plotly.newPlot('leetcode', data, layout, config);
            window.dispatchEvent(new Event('resize'));

        })();

        // strava plot
        (async function () {
            var trace1 = {
                type: 'bar',
                marker: {
                    color: 'blue',
                    line: {
                        width: 2.5
                    }
                }
            };

            const url = "https://raw.githubusercontent.com/yrom1/jira-python/main/plot.json"
            const jira_r = fetch(url)
                .then((response) => response.json())
                .then((x) => {
                    return x;
                });
            let jira_json = await jira_r;
            trace1.x = Object.values(jira_json.date);
            trace1.y = Object.values(jira_json.value);

            var layout = {
                title: (trace1.y[trace1.y.length - 1]).toString() + " Jira Issues Completed Today",
                font: { size: 14 },
                // xaxis: { title: { text: "Date" } },
                yaxis: { title: { text: "# Completed Issues" } },
                height: HEIGHT,
            };

            var config = { responsive: true }
            var data = [trace1];
            Plotly.newPlot('jira', data, layout, config);
            window.dispatchEvent(new Event('resize'));

        })();
    </script>

    <footer class="head">
        <hr />
        <h2>
            <a href="mailto:ryanm.inbox@gmail.com">ryanm.inbox@gmail.com</a>
            |
            <a href="http://github.com/yrom1">github.com/yrom1</a>
        </h2>
        <img alt="credit: Jean-Pol GRANDMONT" class="ginkgo" src="/static/trees.jpg" />
    </footer>
</body>

</html>
